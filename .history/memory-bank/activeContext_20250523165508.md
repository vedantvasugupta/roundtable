# Active Context: Current Work and Focus

## Current Task

*   **Initializing the Memory Bank:** This is the immediate task. Creating and populating the core memory bank files (`projectbrief.md`, `productContext.md`, `systemPatterns.md`, `techContext.md`, `activeContext.md`, `progress.md`).

## Recent Significant Changes

*   **Proposal Creation UX Refactor:** The primary proposal creation flow (`!propose`) was significantly refactored from a single, complex modal to a two-step process:
    1.  Display `ProposalMechanismSelectionView` with buttons for each voting mechanism.
    2.  On button click, display a mechanism-specific modal (e.g., `PluralityProposalModal`) containing only relevant common fields and hyperparameters for that mechanism.
*   **Hyperparameter Storage:** Added a `hyperparameters` TEXT column (storing JSON) to the `proposals` table in `bot_database.db` to store mechanism-specific configurations.
*   **Database Interaction Updates:** Modified `db.py` to handle the new `hyperparameters` column and added functions for `proposal_options`.
*   **Extensive Debugging:** Addressed several issues arising from the refactor, including:
    *   `ImportError`s due to moved functions.
    *   `AttributeError`s related to Discord interaction objects and modal component limits (`ValueError: could not find open space for item`).
    *   `TypeError` for incorrect `TextInput` parameter names (`default_value` vs `default`).
    *   `NameError` for undefined function calls within modal submission logic.
    *   `ValueError` for timestamp conversion issues in SQLite due to `T` separator in ISO 8601 format, requiring a change to space-separated datetime strings for database storage.
    *   Ensured admin notifications for new proposals are triggered.

## Next Steps (Immediate & Short-Term)

*   **Complete Memory Bank Initialization:** Ensure all core files are created with adequate initial information.
*   **Thorough Testing of Refactored Proposal Flow:** Test proposal creation, submission, and database storage for *all* implemented voting mechanisms and their specific modals/hyperparameters.
*   **Verify Admin Notifications:** Confirm that admin notifications for new proposals (pending approval) are working reliably.
*   **Test Title Length:** Confirm the proposal title minimum length has been successfully reduced.
*   **Address Timestamp Issue for Existing Data (Potential):** If the `ValueError` on timestamp conversion persists for *old* proposals, a data migration script or custom SQLite type adapters for datetime objects might be needed.
*   **Review and Refine `winning_threshold` for Plurality:** The `winning_threshold_input` was temporarily removed from `PluralityProposalModal` due to modal component limits. Decide if and how this parameter should be re-introduced (e.g., different UX, or if `None` is an acceptable default handled by `voting_utils.py`).

## Active Decisions & Considerations

*   **Modal Component Limits:** Discord Modals have a limit of 5 `TextInput` components. This constrains the number of hyperparameters that can be directly configured in a single modal. Complex configurations might require multi-step modals or alternative UX approaches if more than 4-5 distinct inputs are needed beyond basic Title, Description, Options, Deadline.
*   **Error Reporting to User:** Ensure users receive clear, actionable feedback if an error occurs during interaction, especially for modal submissions.
*   **Code Modularity and Clarity:** Continue to ensure that logic is well-organized into appropriate modules.

## Important Patterns & Preferences

*   **Explicit Error Handling:** Use `try-except` blocks and provide informative error messages both in logs and to the user where appropriate.
*   **Clear Logging:** Use `print()` for console logging during development for quick debugging, often including `traceback.print_exc()`.
*   **User-Centric UX:** The two-step proposal flow was chosen to improve user experience by avoiding overwhelming users with irrelevant options.